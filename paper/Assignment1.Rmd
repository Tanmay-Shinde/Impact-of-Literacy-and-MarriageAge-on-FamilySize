---
title: "Investigating the Effect of Literacy and Marriage Age on Family Size"
author: "Ariza Hossain, Tanmay Shinde"
date: "February 07, 2024"
output: 
  pdf_document:
    number_sections: true
    toc: true
    toc_depth: 2
bibliography: references.bib
thanks: "Code and data are available at: [EffectOfLiteracyAndMarriageAgeOnFamilySize](https://github.com/Tanmay-Shinde/Impact-of-Literacy-and-MarriageAge-on-FamilySize)"
urlcolor: blue
---

```{r}
#| echo: false
#| warning: false
#| message: false

# install.packages("jtools")
library(jtools)
```

```{r dataDownload, include=FALSE}
pUrl = 'http://wfs.dhsprogram.com/pt/ptsr01.dat'
pName = file.path(tempdir(), 'portugal.dat')
if(!file.exists(pName)) {
  download.file(pUrl, pName)
}

datNames = rbind(
		age=c(45,2),
		ageMarried=c(149,2), 
		monthsSinceM = c(157,4),
#		failedPregnancies=c(421,2),
#		failedPregStill=c(423,2),
#		failedPregSpAb=c(425,2),
		pregnancies=c(433,2),
		children=c(435,2),
		sons=c(443,2),
#		firstBirthInterval = c(479,2),
		region = c(641,2),
		literacy = c(649,2)
)
		colnames(datNames ) = c('start','len')
		datNames = cbind(startm1=datNames[,1]-1,datNames, sum=apply(datNames, 1,sum))
		cbind(datNames[-1,1] , datNames[seq(1, nrow(datNames)-1),4])
		datNames[-1,1] = datNames[-1,2] - datNames[seq(1, nrow(datNames)-1),4]
		dWidths = as.vector(t(datNames[,c(1,3)]))
		dNames = paste(rep(rownames(datNames), rep(2, nrow(datNames))),
  	rep(c( "junk",""), nrow(datNames)), sep="") 
		
		dNames = dNames[dWidths > 0]
		dWidths = dWidths[dWidths > 0]
		
		formats = list(
			ageMarried = data.frame(code=1:7,  label=c(0,15,18,20,22,25,30)),
			region = data.frame(code=1:5, 
				label=c('lisbon','porto','20k+', '10-20k', 'lt10k')),
			literacy = data.frame(code=1:2, label=c('yes','no')),
			firstBirthInterval = data.frame(
					code = 1:8,
					label = c(
							'lt0','0-7', '8-11','12-23',
							'24-35','36-47','48-59','60-Inf'
							)
					)
		)

	

		formats$ageMarried$label = 
  	paste(formats$ageMarried$label, 'to',
  	c(formats$ageMarried$label[-1], 'Inf'), sep='')
  	formats$ageMarried = rbind(formats$ageMarried, data.frame(code=88, label='never'))

   
  portugal = read.fwf(
    pName,
    dWidths, col.names=dNames,
    header=FALSE)
  
  portugal = portugal[,grep("junk$", names(portugal), invert=TRUE)]

for(D in intersect(names(portugal), names(formats))){
  		portugal[[D]] = factor(portugal[[D]],
  			levels=formats[[D]]$code, 
				labels=formats[[D]]$label)
}
portugal$ageMarried = relevel(portugal$ageMarried, '22to25')
portugal$region = relevel(portugal$region, 'lt10k')

if(FALSE) save(portugal, file='portugal.RData')
```

# Introduction {#intro}

## Literature Review and Importance of Study

Understanding the relationship between literacy, age at marriage, and family size is crucial for addressing key societal challenges. Population growth remains a pressing issue, particularly in regions with high fertility rates. Studies have shown that improved literacy rates and delayed marriage can contribute to population control by reducing overall fertility. Moreover, smaller family sizes are associated with better child health outcomes due to increased parental investment per child, leading to improved nutrition, education, and healthcare access. From an economic perspective, a population with a larger proportion of working-age adults—facilitated by smaller family sizes—can drive economic growth by enhancing workforce productivity and reducing dependency ratios. Additionally, promoting female education and delaying marriage are powerful tools for advancing gender equality, empowering women to pursue education and career opportunities, and improving their decision-making autonomy within households. These factors highlight the relevance of this study in informing policies aimed at fostering sustainable development, improved public health, and social equity. !--- make this shorter and relevant ciattions for this. May be not mention population because that is not a concern for portugal ---!

Previous research has established strong correlations between literacy, marriage age, and fertility outcomes. One study found that literate women were significantly more likely to use contraception (54% vs. 43%, p = 0.008), undergo sterilization (94% vs. 44%, p < 0.001), and have fewer children. Additionally, they demonstrated better family planning knowledge and a reduced preference for male children (51% vs. 73%, p = 0.029). Another study found that rural women expressed a higher preference for large families, with 32.1% desiring six or more children. Education played a crucial role in fertility preferences, as 72% of women and 83.6% of men who favored smaller families had at least a secondary education. A third study highlighted the impact of early marriage, showing that women who married before the age of 20 had, on average, one more child than those who married between 25 and 29. Early marriage was linked to higher fertility due to prolonged childbearing periods and lower contraceptive efficiency. Regression analysis indicated that family size was influenced by fecundity, contraceptive use, and social selection factors, reinforcing the association between early marriage and larger families. NEED TO ADD CITATIONS

## Research Objective and Statistical Overview

Building on these findings, our study aims to investigate the extent to which literacy and age at marriage influence family size in Portugal, a developing economy. Specifically, we seek to determine whether higher literacy rates and delayed marriage lead to smaller family sizes and to what degree these factors interact. By synthesizing insights from prior research which were also mostly based in developing economies, we aim to contribute to a more nuanced understanding of how educational and marital timing interventions can shape reproductive behavior and demographic trends in Portugal. To achieve this, we will employ a generalized linear model (GLM) to analyze the impact of literacy and marriage age on family size. This statistical approach will allow us to quantify the effects of these variables while controlling for other relevant factors such as socioeconomic status, geographic location, and gender composition of children. By examining the coefficients derived from the model, we can assess the relative influence of literacy and marital timing on fertility outcomes, providing evidence-based recommendations for policymakers and public health initiatives.


# Methods {#methods}

Our study will use the number of children per woman as the main response variable. The key predictor variables will be the age at marriage, literacy rate, and region. These predictors are included because previous research suggests that literacy and delayed marriage reduce fertility, and regional differences can capture cultural and economic factors influencing family size.
To model the relationship between these variables, we will initially fit a Poisson generalized linear model (GLM). A Poisson model is appropriate because our response variable consists of count data, which are non-negative and right-skewed. We assume that the number of children born to each woman follows a homogeneous Poisson process, meaning that each birth is independent and uniformly distributed over time. This assumption justifies using the Poisson distribution, which is commonly applied to model count data in similar demographic studies.

Next, we will conduct exploratory data analysis to assess the relationships between predictors and their potential interactions. We will use box plots to visualize how two predictors together influence the number of children and whether interactions need to be incorporated into the model. Additionally, we will check for overdispersion by examining the standard errors and estimates of the predictors. If overdispersion is present, meaning the variance is greater than the mean, we will account for it by fitting a negative binomial model, which allows for additional variability in count data. The negative binomial model is particularly useful because it introduces a dispersion parameter, enabling it to handle overdispersed data more effectively than the Poisson model.

Furthermore, we will analyze scatter plots to determine if our data is comparable across different predictor variables. This will help us decide whether an offset term should be included in our model to account for exposure differences among women. Finally, we will compare model fits using statistical criteria, selecting the model that best accounts for overdispersion, interaction effects, and any additional structural patterns in the data. By systematically evaluating these considerations, we aim to produce a robust and interpretable model for understanding the influence of literacy and marriage age on family size.  Add stuff about how we will confirm variations and statistical significance


# Results

## Statistical Summaries of Predictor Variables

```{r}
hist(portugal$children)
```


## Model Results

```{r}
init_model <- glm(children ~ literacy + ageMarried + region, data = portugal, family = poisson)

# knitr::kable(exp(summary(init_model)$coef[,1:2]), digits = 3)
# 
# plot_summs(init_model, exp=T, omit.coefs=NULL)
```

```{r}
# model with confounder
conf_model <- glm(children ~ literacy + ageMarried + region + sons, data = portugal, family = poisson)

# knitr::kable(exp(summary(conf_model)$coef[,1:2]), digits = 3)
# 
# plot_summs(conf_model, exp=T, omit.coefs=NULL)
```

```{r}
anova(init_model, conf_model)
```

```{r}
boxplot(portugal$children ~ portugal$ageMarried + portugal$literacy, horizontal = T,
xlab="num children",
ylab="", las=1,
cex.axis=0.75, cex.lab=0.75)
```

```{r}
boxplot(portugal$children ~ portugal$ageMarried + portugal$region, horizontal =T,
xlab="num children",
ylab="", las=1,
cex.axis=0.75, cex.lab=0.75)
```

```{r}
boxplot(portugal$children ~ portugal$literacy + portugal$region, horizontal = T,
xlab="num children",
ylab="", las=1,
cex.axis=0.75, cex.lab=0.75)
```

```{r}
int_model <- glm(children ~ literacy*ageMarried + region + sons, data = portugal, family = poisson)

# knitr::kable(exp(summary(int_model)$coef[,1:2]), digits = 3)
# 
# plot_summs(int_model, exp=T, omit.coefs=NULL)
```

```{r}
# Checking 
anova(conf_model, int_model)
```

```{r}
int_model2 <- glm(children ~ ageMarried + literacy*region + sons, data = portugal, family = poisson)

# knitr::kable(exp(summary(int_model2)$coef[,1:2]), digits = 3)
# 
# plot_summs(int_model2, exp=T, omit.coefs=NULL)
```

```{r}
# Checking 
anova(conf_model, int_model2)
```


```{r}
# yrs since married offset
portugal$logYrsMarried <- log(pmax(1, portugal$monthsSinceM)/12)

yrsOff_model <- glm(children ~ offset(logYrsMarried) + literacy + ageMarried + region + sons, data = portugal, family = poisson)

# knitr::kable(exp(summary(yrsOff_model)$coef[,1:2]), digits = 3)
```

```{r}
plot_summs(conf_model, yrsOff_model, exp=T, omit.coefs=F, model.names=c("w/out offset", "w/ yrs married offset"))
```



```{r}
m <- aggregate(portugal$children, by=list(portugal$ageMarried, portugal$literacy), mean)
v <- aggregate(portugal$children, by=list(portugal$ageMarried, portugal$literacy), var)

tab <- cbind(m, v[,3])
knitr::kable(tab, digits=2, col.names=c("AgeMarried", "Literacy", "Mean", "Variance"))
```

```{r}
dispersion_ratio <- summary(yrsOff_model)$deviance / summary(yrsOff_model)$df.residual
dispersion_ratio
```



## Discussion of Modelling Process


# Conclusion

## Interpretation of Model Results

## Comparison of Model Effects with Existing Literature

## Closing Remarks

